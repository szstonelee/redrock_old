[回中文总目录](menu_cn.md)

# 备份，持久化

## 不要用Rcocksdb目录备份

首先，绝对不用用Rocksdb目录（[参考这里](howrun_cn.md)）作为备份数据，因为内存的value是不会到RocksdB目录下的数据文件的。如果你用Rocksdb目录的文件，那么你会丢失内存里的数据。

你可以用两种方式，RDB or AOF进行备份，即Redis常规的备份方式，可以参考Redis的[持久化文档](https://redis.io/topics/persistence)

## 磁盘容量和读写盘时间

因为用RedRock，就是考虑这样的User Case，大量数据在磁盘上，只有全部的key和少部分的Value（对应的key，我们称之为HotKey）在内存里。

所以，备份并不是像Redis传统的那样，对内存做个全面扫描就完成的，而是要对磁盘进行大量读写，因为大部分value很可能不在内存里，而且，此时因为内存已经达到[maxmemory](howrun_cn.md)
（注意：Redis里定义的maxmemory并不包括fork()产生的备份进程内存），备份时，存在大量的原来内存里的hotkey被写到磁盘以腾出内存空间去满足maxmemory，所以，不管是时间上（因为磁盘读写远远慢于内存扫描，你可以估测有10K的差别），还是所需磁盘，还是对当前hotkey有巨大冲击，这些代价都将是巨额的，你必须慎重考虑。个人建议：需要仔细规划你的备份策略并做好测试。

相比较而言，AOF比较好一些，因为AOF，如果不是第一次做全量扫描从而导致大量的读写盘，后面的，都是增量写入，因此代价会小很多

## 备份是Snapshot，保证一致性

备份是启动那个时刻的静止数据快照，即使备份时间可能巨长，但数据都是备份那个时刻的静态数据。如果你是fork出新进程备份，那么RedRock可以继续服务你的客户，并且这些客户可以照常读写，不受任何影响。